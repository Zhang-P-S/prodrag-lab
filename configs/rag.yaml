# =========================================================
# RAG 主配置文件
# 用于 eval_run_local.py / eval_run_sft.py
# =========================================================

setting: baseline   # baseline / rerank / refusal / sft

paths:
  qa_jsonl: data/eval/qa_v1_200.jsonl
  run_out: artifacts/rag_eval/baseline_local.jsonl
  index_dir: data/index

# =========================================================
# LLM 配置
# =========================================================
llm:
  backend: local   # local / api

  api:
    provider: deepseek
    model: deepseek-chat
    api_key: $DEEPSEEK_API_KEY
    base_url: https://api.deepseek.com

  local:
    model_path: /home/zps/models/llm/models--unsloth--DeepSeek-R1-Distill-Qwen-7B-bnb-4bit/snapshots/5c46879548e720d7b7d640251a09926b92627fcd
    lora_path: null     # SFT 时填 LoRA 路径
    dtype: float16
    device: cuda

# =========================================================
# 检索模块
# =========================================================
retrieval:
  dense:
    model_name: BAAI/bge-small-zh-v1.5
    topk: 8

  bm25:
    enable: true
    topk: 8

  fusion:
    method: rrf        # rrf / weighted
    rrf_k: 60

  final_topk: 6        # 双路融合后送入LLM的chunk数量

# =========================================================
# 重排模块
# =========================================================
rerank:
  enable: false
  model_name: cross-encoder/ms-marco-MiniLM-L-6-v2
  topk: 4

# =========================================================
# 拒答控制
# =========================================================
refusal:
  enable: true
  score_threshold: 0.35   # top1 检索分数低于此值触发拒答
  margin_threshold: 0.15  # top1 - top2 差值过小触发拒答

# =========================================================
# 生成参数
# =========================================================
gen:
  max_tokens: 256
  temperature: 0.2
  top_p: 0.9

# =========================================================
# 评测控制
# =========================================================
eval:
  seed: 42
  max_items: 200
  dual_lang: true
  flush_every: 10
